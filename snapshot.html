<!DOCTYPE html><html lang="nl"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 35.4.1">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
  
  
  
  
<script>document.title = respecConfig.title</script>
<title>Handreiking "Hoe bouw ik een register" 0.0.1</title>
  
<title>Default</title>
  
<link rel="shortcut icon" type="image/x-icon" href="https://website-digilab-overheid-nl-research-uit-betrouw-e1f39021ce924c.gitlab.io/img/ubblogo.png">
  
  
  
<style>

	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: none !important; 
	}
	h7 {
		font-style: italic;
	}
	h7::after{
		content: "\a";
		white-space: pre;
	}
 	h7::before{
		content: "\a";
		white-space: pre;
	}
  
</style>

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:italic}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline;position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-.7em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<style id="respec-nlgov">
img.license{float:left;padding-right:5px;background:0 0}
</style>
<meta name="color-scheme" content="light">
<style>
ul.index{columns:30ch;column-gap:1.5em}
ul.index li{list-style:inherit}
ul.index li span{color:inherit;cursor:pointer;white-space:normal}
#index-defined-here ul.index li{font-size:.9rem}
ul.index code{color:inherit}
#index-defined-here .print-only{display:none}
@media print{
#index-defined-here .print-only{display:initial}
}
</style>
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<script id="initialUserConfig" type="application/json">{
  "shortName": "Respec-template",
  "pubDomain": "pr",
  "specType": "PR",
  "specStatus": "IO",
  "publishDate": "2025-10-13",
  "publishVersion": "0.0.1",
  "title": "Handreiking \"Hoe bouw ik een register\"",
  "subtitle": "Richtlijnen en adviezen voor het bouwen van een capabel register",
  "content": {
    "mermaid": "",
    "ch01": "informative",
    "ch02": ""
  },
  "authors": [
    {
      "name": "Marc van Andel",
      "company": "Kadaster",
      "companyURL": "https://kadaster.nl"
    },
    {
      "name": "Ivo Hendriks",
      "company": "VNG Realisatie",
      "companyURL": "https://vng.nl/artikelen/vng-realisatie"
    },
    {
      "name": "Jeanot Bijpost",
      "company": "VNG Realisatie",
      "companyURL": "https://vng.nl/artikelen/vng-realisatie"
    },
    {
      "name": "Johan Boer",
      "company": "VNG Realisatie",
      "companyURL": "https://vng.nl/artikelen/vng-realisatie"
    },
    {
      "name": "Roel Harbers",
      "company": "Uit betrouwbare bron",
      "companyURL": "https://uitbetrouwbarebron.nl"
    },
    {
      "name": "Thom Bogers",
      "company": "Uit betrouwbare bron",
      "companyURL": "https://uitbetrouwbarebron.nl"
    },
    {
      "name": "Boris Bonsel",
      "company": "VNG Realisatie",
      "companyURL": "https://vng.nl/artikelen/vng-realisatie"
    }
  ],
  "editors": [
    {
      "name": "Marc van Andel",
      "company": "Kadaster",
      "companyURL": "https://kadaster.nl"
    },
    {
      "name": "Ivo Hendriks",
      "company": "VNG Realisatie",
      "companyURL": "https://vng.nl/artikelen/vng-realisatie"
    }
  ],
  "gitlab": "https://gitlab.com/Uitbetrouwbarebron",
  "alternateFormats": [
    {
      "label": "pdf",
      "uri": "handreiking-register"
    }
  ],
  "localBiblio": {
    "MIM": {
      "href": "https://docs.geostandaarden.nl/mim/mim/",
      "publisher": "Geonovum",
      "title": "MIM - Metamodel Informatie Modellering",
      "date": "Oktober 2023",
      "rawDate": "2023"
    },
    "SemVer": {
      "href": "https://semver.org/lang/nl/",
      "title": "Semantisch Versioneren 2.0.0",
      "date": "December 19, 2023",
      "rawDate": "2023"
    }
  }
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/base.css"></head>

<body><h1 id="title" class="title">Handreiking "Hoe bouw ik een register" 0.0.1</h1>
  <section id="leeswijzer">


<meta charset="utf-8">
<title>Error</title>


<pre aria-busy="false"><code class="hljs">Cannot GET /leeswijzer.md</code></pre>

</section>
  <section id="sotd"></section><nav id="toc"><h2 class="introductory" id="inhoudsopgave">Inhoudsopgave</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#command"><bdi class="secno">1. </bdi>Command</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#twijfel-en-dry-run"><bdi class="secno">1.1 </bdi>Twijfel en dry-run</a></li><li class="tocline"><a class="tocxref" href="#transacties"><bdi class="secno">1.2 </bdi>Transacties</a></li></ol></li><li class="tocline"><a class="tocxref" href="#grenzen"><bdi class="secno">2. </bdi>De omgeving en grenzen van een register</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#autonomie-en-gemeenschappelijkheid"><bdi class="secno">2.1 </bdi>Autonomie en gemeenschappelijkheid</a></li><li class="tocline"><a class="tocxref" href="#registergrenzen-domein"><bdi class="secno">2.2 </bdi>Registergrenzen: domein</a></li><li class="tocline"><a class="tocxref" href="#bounded-context"><bdi class="secno">2.3 </bdi>Bounded context</a></li><li class="tocline"><a class="tocxref" href="#wellbounded-registers"><bdi class="secno">2.4 </bdi>'Wellbounded' registers</a></li><li class="tocline"><a class="tocxref" href="#bepalen-van-de-bounds"><bdi class="secno">2.5 </bdi>Bepalen van de 'bounds'</a></li><li class="tocline"><a class="tocxref" href="#uitvoeringsproces-op-hoofdlijnen"><bdi class="secno">2.6 </bdi>Uitvoeringsproces op hoofdlijnen</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#het-domeinmodel-als-kern"><bdi class="secno">2.6.1 </bdi>Het domeinmodel als kern</a></li><li class="tocline"><a class="tocxref" href="#signaal-ontvangen-en-interpreteren"><bdi class="secno">2.6.2 </bdi>Signaal ontvangen en interpreteren</a></li><li class="tocline"><a class="tocxref" href="#taken-definieren-en-uitvoeren"><bdi class="secno">2.6.3 </bdi>Taken definiëren en uitvoeren</a></li><li class="tocline"><a class="tocxref" href="#gevolgen-vastleggen"><bdi class="secno">2.6.4 </bdi>Gevolgen vastleggen</a></li><li class="tocline"><a class="tocxref" href="#informatie-beschikbaar-stellen"><bdi class="secno">2.6.5 </bdi>Informatie beschikbaar stellen</a></li></ol></li><li class="tocline"><a class="tocxref" href="#applicatieve-ondersteuning-met-het-register"><bdi class="secno">2.7 </bdi>Applicatieve ondersteuning met het register</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#van-proces-naar-applicatie"><bdi class="secno">2.7.1 </bdi>Van proces naar applicatie</a></li><li class="tocline"><a class="tocxref" href="#notificatie-command-signaalverwerking"><bdi class="secno">2.7.2 </bdi>Notificatie → Command (Signaalverwerking)</a></li><li class="tocline"><a class="tocxref" href="#command-effecten-taakuitvoering"><bdi class="secno">2.7.3 </bdi>Command → Effecten (Taakuitvoering)</a></li><li class="tocline"><a class="tocxref" href="#effecten-projecties-presentatieopmaking"><bdi class="secno">2.7.4 </bdi>Effecten → Projecties (Presentatieopmaking)</a></li><li class="tocline"><a class="tocxref" href="#register-commands-effecten-projecties"><bdi class="secno">2.7.5 </bdi>Register = Commands + Effecten + Projecties</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">3. </bdi>Conformiteit</a></li><li class="tocline"><a class="tocxref" href="#index"><bdi class="secno">A. </bdi>Index</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#index-defined-here"><bdi class="secno">A.1 </bdi>Begrippen gedefinieerd door deze specificatie</a></li><li class="tocline"><a class="tocxref" href="#index-defined-elsewhere"><bdi class="secno">A.2 </bdi>Begrippen gedefinieerd door verwijzing</a></li></ol></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>Referenties</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normatieve-referenties"><bdi class="secno">B.1 </bdi>Normatieve referenties</a></li></ol></li></ol></nav>
  <section id="command"><h2 id="x1-command"><bdi class="secno">1. </bdi>Command</h2>
<ul>
<li>Werkdefinitie: een command is een opdracht aan het register, aangeboden met de intentie daarin een verandering aan te brengen.</li>
<li>Aangepast vanwege een test of zeven</li>
</ul>
<section id="twijfel-en-dry-run"><h3 id="x1-1-twijfel-en-dry-run"><bdi class="secno">1.1 </bdi>Twijfel en dry-run</h3>
<ul>
<li><p>Aan gegevens in een capabel register kan getwijfeld worden. Dit heeft gevolgen voor het geautomatiseerd verwerken van commando's. Systemen kunnen immers niet (altijd) (geautomatiseerd) commando's verwerken als bij het beoordelen daarvan betwijfelde gegevens betrokken zijn. Dit is niet per se een registervraagstuk. Wel een vraagstuk dat zich op dit moment veelal buiten registers - en wel binnen procesondersteunende systemen - afspeelt.</p>
</li>
<li><p>Willen we registers en degenen die ze bedienen (beter) laten werken met betwijfelde gegevens, dan is één oplossing het aanbieden van interfaces die het mogelijk maken daarover met het register te converseren. Wanneer sprake is van twijfel over de juistheid van relevante gegevens, kan in zo'n conversatie van verwerkingsregels worden afgeweken. Mits beargumenteerd en voorzien van instructies over hoe en waar specifieke regels wel of niet moeten worden toegepast, wordt een waarschuwing of error zo dus 'overrulebaar'.</p>
</li>
<li><p>Hieraan gerelateerd is het idee van 'dry run-functionaliteit'. Dit is een query die antwoord geeft op de vraag of een command verwerkt kan worden zonder een poging te doen dat command daadwerkelijk te verwerken.  Om verschillende uitkomsten tussen 'dry run' en daadwerkelijke registratie te voorkomen, ligt het - ondanks scheiding tussen command en query (CQRS) - voor de hand deze query te laten beantwoorden aan de commandkant van het register, waar immers ook de daadwerkelijke verwerking van het command moet plaatsvinden.</p>
</li>
</ul>
</section><section id="transacties"><h3 id="x1-2-transacties"><bdi class="secno">1.2 </bdi>Transacties</h3>
<p>Conventie (en aanbeveling?):</p>
<ul>
<li>Command is een opdracht die één transactie verwerkt moet worden.</li>
</ul>
<p>...maar: business bepaalt in eerste instantie transactiegrenzen, commands sluiten daarbij aan.</p>
<p>...maar: digitaal werken kan innovatie in business mogelijk maken. Sneller (en sequentieel) verwerken van wijzigingen in 'echte' wereld kan bijvoorbeeld consistentiewaarborgen van aggregaatniveau naar registerniveau (dat daardoor in feite zelf aggregaat wordt?) brengen.</p>
</section></section>
  <section id="grenzen"><h2 id="x2-de-omgeving-en-grenzen-van-een-register"><bdi class="secno">2. </bdi>De omgeving en grenzen van een register</h2>
<p><strong>Een register heeft betekenis door het proces dat het ondersteunt.</strong> Om te begrijpen waar de
grenzen liggen, beginnen we bij het <a href="https://www.gemmaonline.nl/wiki/Common_Ground_vijflaagsmodel">vijflaagsmodel van Common
Ground</a>:</p>
<table>
<thead>
<tr>
<th align="center">Laag</th>
<th>Naam</th>
<th>Wat</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>5</strong></td>
<td><strong>Interactie</strong></td>
<td>Gebruikersinterfaces, kanalen en toegang</td>
</tr>
<tr>
<td align="center"><strong>4</strong></td>
<td><strong>Procesinrichting</strong></td>
<td>Bedrijfsprocessen, bedrijfsregels en informatiestructuren</td>
</tr>
<tr>
<td align="center"><strong>3</strong></td>
<td><strong>Connectiviteit</strong></td>
<td>Veilige verbindingen</td>
</tr>
<tr>
<td align="center"><strong>2</strong></td>
<td><strong>Diensten</strong></td>
<td>Datadiensten, APIs en services</td>
</tr>
<tr>
<td align="center"><strong>1</strong></td>
<td><strong>Databronnen</strong></td>
<td>Registers, bijhouding en vastlegging</td>
</tr>
<tr>
<td align="center">(<strong>0</strong></td>
<td><strong>Infrastructuur</strong></td>
<td>Hardware en infrastructuur)</td>
</tr>
</tbody></table>
<p>Een register bevindt zich in laag 1 (databronnen) en laag 2 (diensten). Een register sluit aan bij
laag 4 (procesinrichting) door de <strong>informatiestructuren</strong> van het proces: de conceptuele modellen
die beschrijven welke informatie het proces nodig heeft en produceert.</p>
<section id="autonomie-en-gemeenschappelijkheid"><h3 id="x2-1-autonomie-en-gemeenschappelijkheid"><bdi class="secno">2.1 </bdi>Autonomie en gemeenschappelijkheid</h3>
<p>Binnen <a href="https://commonground.nl/">Common Ground</a> ligt de <strong>autonomie van gemeenten</strong> bij de
interactielaag (hoe burgers worden bediend) en de procesbesturing (hoe het werk wordt
georganiseerd). Elke gemeente kan eigen keuzes maken in werkwijze en gebruikersinteractie.</p>
<p>De <strong><em>common ground</em></strong> - wat gemeenschappelijk is - ligt bij het domeinmodel: welke acties mogelijk
zijn binnen een domein en welke gevolgen deze hebben. Dit zorgt voor interoperabiliteit terwijl
gemeenten hun autonomie behouden.</p>
<p>Gemeenten zijn hier gebruikt als voorbeeld, want dit geldt voor alle organisaties waar autonomie en
gemeenschappelijkheid een rol spelen, oftewel een gedeeld domein betreffen.</p>
</section><section id="registergrenzen-domein"><h3 id="x2-2-registergrenzen-domein"><bdi class="secno">2.2 </bdi>Registergrenzen: domein</h3>
<p>Een register is een verzameling geordende informatie. De grenzen van de verzameling worden net als
de betekenis en samenhang van de in het register opgeslagen informatie bepaald vanuit het <strong>domein</strong>
dat voor het register verantwoordelijk is. Anders dan in de
<a href="https://nl.wikipedia.org/wiki/Domein_(wiskunde)">wiskunde</a> kunnen we voor registers niet precies
aangeven waar het ene domein ophoudt en het volgende begint. Analoog aan de definitie van
<cite><a class="bibref" data-link-type="biblio" href="#bib-domain-driven-design#the-blue-book">Eric Evans in de context van Domain Driven Design</a></cite> beschouwen
we een domein daarom als "een sfeer van kennis, invloed of activiteit". Deze definitie veronderstelt
een zekere mate van samenhang. Tegelijkertijd kan het binnen één domein voorkomen dat:</p>
<ul>
<li>dezelfde concepten verschillend geïnterpreteerd worden,</li>
<li>regels en gedrag niet consistent zijn, en</li>
<li>bedrijfsprocessen niet op elkaar zijn afgestemd.</li>
</ul>
<p>Voor wie zoekt naar aanknopingpunten over welke informatie binnen 'hoort' binnen een te ontwerpen
register en welke buiten de registergrenzen zou moeten vallen, biedt het denken in 'sferen'
onvoldoende aanknopingspunten. Daarom introduceren we <strong>bounded context</strong> als begrenzend begrip. Ook
dit concept is ontleend aan [<cite><a class="bibref respec-offending-element" data-link-type="biblio" href="#bib-domain-driven-design" title="Reference &quot;[domain-driven-design]&quot; not found." id="respec-offender-reference-domain-driven-design-not-found">domain-driven-design</a></cite>].</p>
</section><section id="bounded-context"><h3 id="x2-3-bounded-context"><bdi class="secno">2.3 </bdi>Bounded context</h3>
<p>Binnen een domein kunnen meerdere subdomeinen of taakgebieden bestaan. Daarbij horen
verantwoordelijkheden, die zijn toegekend aan specifieke teams, afdelingen of bedrijfseenheden. Zij
worden ondersteund door eigen semantiek, processen en regels. Deze zaken kunnen worden beschreven in
een <strong>model</strong>: een systeem van abstracties dat beschrijft hoe men vanuit een taakgebied naar de
wereld kijkt en reageert op veranderingen in de buitenwereld. Zo'n model is beschreven in
<strong>gemeenschappelijke taal</strong> die binnen het hele taakgebied begrepen wordt. Model en taal beschrijven
dus een voor betrokkenen herkenbare 'blauwdruk' van het taakgebied, die (onder andere) de basis kan
vormen voor het ontwerp van een register. Een in gemeenschappelijke taal ondubbelzinnig en
samenhangend gemodelleerd taakgebied noemen we een '<strong>bounded context</strong>'.</p>
<p>Het belang van het erkennen van bounded contexten wordt door Eric Evans in
<cite><a class="bibref" data-link-type="biblio" href="#bib-domain-driven-design#the-blue-book">'the Blue Book'</a></cite> als volgt beschreven:</p>
<blockquote>
<p>"A bounded context delimits the applicability of a particular model so that team members have a
clear and shared understanding of what has to be consistent and how it relates to other contexts.
Within that context, work to keep the model logically unified, but do not worry about applicability
outside those bounds. In other contexts, other models apply, with differences in terminology, in
concepts and rules, and in dialects of the ubiquitous language <em>[red. gemeenschappelijke taal]</em>. By
drawing an explicit boundary, you can keep the model pure, and therefore potent, where it is
applicable. At the same time, you avoid confusion when shifting your attention to other contexts.
Integration across the boundaries necessarily will involve some translation, which you can analyze
explicitly."</p>
</blockquote>
<p>Uit het bovenstaande blijkt dat de ambiguïteiten die we op domeinniveau nog konden tegenkomen binnen
een bounded context (idealiter) verdwijnen. Hier geldt (zoveel mogelijk) dat:</p>
<ul>
<li>dezelfde concepten eenduidig geïnterpreteerd worden (op basis van gemeenschappelijke taal),</li>
<li>regels en gedrag consistent zijn, en</li>
<li>bedrijfsprocessen op elkaar aansluiten.</li>
</ul>
</section><section id="wellbounded-registers"><h3 id="x2-4-wellbounded-registers"><bdi class="secno">2.4 </bdi>'Wellbounded' registers</h3>
<p>Bestaande registers bestrijken vaak meerdere bounded contexten. Zo zou je bijvoorbeeld binnen de
Basisregistratie Personen (BRP) bijgehouden informatie over verblijfplaats, verblijfsrecht,
kiesrecht en reisdocumenten ieder als 'eigen' bounded context kunnen beschouwen. Als je dat
onderschrijft en op basis daarvan nieuwe registers zou gaan ontwerpen en ontwikkelen, loop je tegen
een aantal (nieuwe) problemen aan:</p>
<ul>
<li><strong>Integratiecomplexiteit</strong> (met name ten opzichte van registers met een 'breder' bereik).
Registers moeten worden verbonden middels API's, events of gegevenssynchronisatie.</li>
<li><strong>Hoge initiële leercurve.</strong> Ontwerp en ontwikkeling van registers vereist diepgaande
domeinkennis.</li>
<li><strong>Lagere ontwikkelsnelheid.</strong> Opdoen van domeinkennis en omzetten daarvan naar modellen en code
vraagt tijd.</li>
</ul>
<p>Tegelijkertijd worden aan overheidsregisters bijzondere eisen gesteld, onder meer als het gaat om
kwaliteit en betrouwbaarheid. Onderstaande voordelen van het koppelen van registers aan een (of één)
bounded context ondersteunen deze eisen, en wegen wat ons betreft zwaarder dan de nadelen:</p>
<ul>
<li><strong>Duidelijkheid</strong>. Registers omvatten ondubbelzinnige terminologie en logica.</li>
<li><strong>Consistentie</strong>. Registers omvatten logisch consistente set regels en modellen.</li>
<li><strong>Autonomie</strong>. Registers in verschillende bounded contexten kunnen onafhankelijk van elkaar werken
en (door)ontwikkeld worden.</li>
</ul>
<p>Daarom doen we de volgende aanbevelingen voor het begrenzen van registers:</p>
<ol>
<li>Een register valt samen met een (en één) bounded context, en dus</li>
<li>bepalen de bijhoudingsverantwoordelijke(n) de registergrenzen</li>
</ol>
</section><section id="bepalen-van-de-bounds"><h3 id="x2-5-bepalen-van-de-bounds"><bdi class="secno">2.5 </bdi>Bepalen van de 'bounds'</h3>
<p>In de praktijk laten de 'bounds' van een context zich niet altijd gemakkelijk herkennen en
afbakenen. Bovendien kunnen bounded contexten onder invloed van impliciete of uitgesproken belangen
worden 'opgerekt' of juist verkleind. In algemene zin is moeilijk te zeggen wanneer voor een
register de 'ideale' bounded context is gevonden. Wel zijn enkele aanwijzingen voor een te ruime of
te krappe afbakening te geven. Deze zijn hieronder beschreven.</p>
<p>Indicatoren en symptomen (van sterk naar zwakker) voor een te ruime bounded context:</p>
<ol>
<li><strong>Gebrek aan gemeenschappelijke taal.</strong> Er is discussie over concepten en betekenis, betrokkenen
hanteren verschillend jargon.</li>
<li><strong>Regels en gedrag niet in samenhang te brengen.</strong> Het lukt niet tot een samenhangend model te
komen.</li>
<li><strong>Afwijkende werkwijze(n).</strong> Bedrijfsprodcessen zijn niet te verenigen.</li>
<li><strong>Ontwerp-/owikkeltraject heeft onwenselijke overhead.</strong> Het ontwerp-/ontwikkelteam is te groot
(geworden).</li>
<li><strong>(Vermijdbare) overschrijding van team- en/of organisatiegrenzen.</strong> Conflict tussen eigenaren
en/of verantwoordelijken.</li>
<li><strong>Registeronderdelen vereisen verschillende opslag- en/of integratietechniek.</strong> Niet-verenigbare
technische vereisten.</li>
</ol>
<p>Indicatoren en symptomen (van sterk naar zwakker) voor een te krappe bounded context:</p>
<ol>
<li><strong>Registeroverstijgende consistentiewaarborgen vereist.</strong>
<a href="https://www.baeldung.com/cs/saga-pattern-microservices">Saga's</a> zijn nodig om transacties
gedistribueerd af te handelen.</li>
<li><strong>Model beschrijft domein zonder zelfstandig bestaansrecht.</strong> Gegevens in een register hebben
‘los’ geen enkel bestaansrecht en zijn niet te generaliseren voor gebruik in andere domeinen.</li>
</ol>
</section><section id="uitvoeringsproces-op-hoofdlijnen"><h3 id="x2-6-uitvoeringsproces-op-hoofdlijnen"><bdi class="secno">2.6 </bdi>Uitvoeringsproces op hoofdlijnen</h3>
<p>Het uitvoeringsproces binnen een domein volgt een herkenbaar patroon. Door dit patroon te begrijpen,
wordt duidelijk waar het register precies bijdraagt en waar de grenzen liggen.</p>
<p>// <strong>TODO</strong> Vereenvoudigd plaatje van een administratief uitvoeringsproces (process flow plaatje?):
Signaal -&gt; Taak -&gt; Gevolg -&gt; Presentatie</p>
<p><strong>Stap 1: Signaal ontvangen</strong> Een proces start altijd met een signaal - een melding dat er iets is
gebeurd wat aandacht vraagt. Dit signaal kan van buiten het domein komen (bijvoorbeeld een melding
van een burger) of van binnen (bijvoorbeeld een (automatische) controle die iets detecteert).</p>
<p><strong>Stap 2: Taken creëren</strong> Het proces beoordeelt het signaal en bepaalt welke acties nodig zijn. Deze
acties worden vastgelegd als taken. Een signaal kan leiden tot één taak, meerdere taken, of soms
geen taken als geen actie nodig is.</p>
<p><strong>Stap 3: Taken uitvoeren</strong> Elke taak wordt uitgevoerd volgens de regels van het domein. Dit kan
handmatige verificatie inhouden, automatische berekeningen, of andere domeinspecifieke activiteiten.</p>
<p><strong>Stap 4: Gevolgen vastleggen</strong> Het uitvoeren van taken levert gevolgen op - dit zijn de definitieve
veranderingen die het domein accepteert als geldig. Deze gevolgen vormen de waarheid voor dit
domein. Ze beschrijven wat er is gebeurd: een persoon is verhuisd, een huwelijk is voltrokken, een
kind is geboren, een bedrijf is ingeschreven, een eigendom is overgedragen.</p>
<p><strong>Stap 5: Presentatie opmaken</strong> De gevolgen worden niet rechtstreeks gedeeld, maar gebruikt om
projecties op te maken die aansluiten bij specifieke informatiebehoeften. Een verhuizing kan
bijvoorbeeld leiden tot verschillende presentaties: een uittreksel voor de gemeente, een
adreswijziging voor de belastingdienst, of een notificatie voor de zorgverzekeraar. Elke
presentatie[^1] toont alleen de informatie die relevant is voor de ontvangende partij.</p>
<p>Deze cyclus vormt de kern van elk register-ondersteund proces. Het register bewaart de gevolgen en
stelt ze beschikbaar voor raadpleging.</p>
<p><img src="/assets/uitvoeringsproces.svg" alt="Gedetailleerd uitvoeringsproces dat het register ondersteunt">
<em>Figuur 2: Gedetailleerd uitvoeringsproces dat het register ondersteunt</em></p>
<section id="het-domeinmodel-als-kern"><h4 id="x2-6-1-het-domeinmodel-als-kern"><bdi class="secno">2.6.1 </bdi>Het domeinmodel als kern</h4>
<p>Het <strong>domeinmodel</strong> definieert wat binnen het domein mogelijk is. Het beschrijft:</p>
<ul>
<li><strong>Taakdefinities</strong>: Welke acties mogelijk zijn binnen het domein</li>
<li><strong>Taakverwerkingsregels</strong>: Hoe taken worden uitgevoerd en welke gevolgen ze hebben</li>
<li><strong>Presentatiedefinities</strong>: Welke informatie in welke vorm beschikbaar gesteld wordt</li>
<li><strong>Presentatieverwerkingsregels</strong>: Hoe gevolgen worden omgezet naar specifieke informatiebehoeften</li>
</ul>
<p><strong>Signaalverwerking staat buiten het domeinmodel.</strong> Allerlei signalen kunnen op het proces afkomen.
De signaalverwerking interpreteert deze naar het domeinmodel toe: welke van de beschikbare taken
moet worden uitgevoerd?</p>
<p>Het domeinmodel vormt de kern van wat het register ondersteunt - de mogelijke acties en hun
gevolgen.</p>
</section><section id="signaal-ontvangen-en-interpreteren"><h4 id="x2-6-2-signaal-ontvangen-en-interpreteren"><bdi class="secno">2.6.2 </bdi>Signaal ontvangen en interpreteren</h4>
<ul>
<li>Een gebeurtenis binnen of buiten het domein leidt tot een <em>Signaal</em></li>
<li><em>Signaalverwerking</em> beoordeelt of dit signaal relevant is voor het domein</li>
<li>Relevante signalen worden vertaald naar acties die het domein kan uitvoeren</li>
</ul>
</section><section id="taken-definieren-en-uitvoeren"><h4 id="x2-6-3-taken-definieren-en-uitvoeren"><bdi class="secno">2.6.3 </bdi>Taken definiëren en uitvoeren</h4>
<ul>
<li>Uit het signaal ontstaan één of meerdere <em>Taken</em> die binnen het domein uitgevoerd kunnen worden</li>
<li><em>Taakuitvoering</em> voert deze taken uit volgens de regels van het <em>Domeinmodel</em></li>
<li>Taken volgen <em>Taakdefinities</em> en <em>Taakverwerkingsregels</em> uit het domeinmodel</li>
</ul>
</section><section id="gevolgen-vastleggen"><h4 id="x2-6-4-gevolgen-vastleggen"><bdi class="secno">2.6.4 </bdi>Gevolgen vastleggen</h4>
<ul>
<li>Uitgevoerde taken leiden tot <em>Gevolgen</em> - de daadwerkelijke veranderingen in het domein</li>
<li>Deze gevolgen vormen de nieuwe waarheid voor dit domein</li>
</ul>
</section><section id="informatie-beschikbaar-stellen"><h4 id="x2-6-5-informatie-beschikbaar-stellen"><bdi class="secno">2.6.5 </bdi>Informatie beschikbaar stellen</h4>
<ul>
<li><em>Presentatieopmaking</em> creëert verschillende <em>Presentaties</em> op basis van de gevolgen</li>
<li>Elke presentatie is afgestemd op specifieke informatiebehoeften volgens <em>Presentatiedefinities</em> en
<em>Effectverwerkingsregels</em> uit het domeinmodel</li>
<li>Presentaties kunnen als nieuwe signalen dienen voor vervolgprocessen in eigen of andere domeinen</li>
</ul>
</section></section><section id="applicatieve-ondersteuning-met-het-register"><h3 id="x2-7-applicatieve-ondersteuning-met-het-register"><bdi class="secno">2.7 </bdi>Applicatieve ondersteuning met het register</h3>
<p>Het uitvoeringsproces krijgt concrete vorm in een applicatiearchitectuur. Het register ondersteunt
dit proces door de juiste componenten en datastromen in te richten. Ultiem is een (business)
domeinmodel gelijk aan een register, één <em>bounded context</em> met eigen regels en begrippen, zoals
bedoeld in [<cite><a class="bibref respec-offending-element" data-link-type="biblio" href="#bib-domain-driven-design" title="Reference &quot;[domain-driven-design]&quot; not found." id="respec-offender-reference-domain-driven-design-not-found-0">domain-driven-design</a></cite>]. Veel vaker is het zo dat er meerdere bounded contexten te
onderscheiden zijn in één business domeinmodel[^2]. Dit heeft te maken met verantwoordelijkheden en
technologie <em>stacks</em> en hebben vaak ook historische redenen; de verzameling van applicaties die door
de tijd heen ontwikkeld zijn. Toch tekenen we hier de eenvoudige en ultieme situatie als
uitgangspunt.</p>
<p><img src="/assets/registeranatomie.svg" alt="Applicatieve ondersteuning en architectuurelementen waaruit het register
bestaat"> <em>Figuur 3: Applicatieve ondersteuning en
architectuurelementen waaruit het register bestaat</em></p>
<section id="van-proces-naar-applicatie"><h4 id="x2-7-1-van-proces-naar-applicatie"><bdi class="secno">2.7.1 </bdi>Van proces naar applicatie</h4>
<p>Het abstracte proces wordt concreet door deze architectuurcomponenten:</p>
</section><section id="notificatie-command-signaalverwerking"><h4 id="x2-7-2-notificatie-command-signaalverwerking"><bdi class="secno">2.7.2 </bdi>Notificatie → Command (Signaalverwerking)</h4>
<ul>
<li><strong>Notificatieprocessor</strong> ontvangt <em>notificaties</em> van binnen en buiten het domein</li>
<li>Beoordeelt relevantie voor het eigen domein door raadpleging van projecties</li>
<li>Vertaalt relevante notificaties naar <em>commands</em> volgens domeinconventies</li>
</ul>
</section><section id="command-effecten-taakuitvoering"><h4 id="x2-7-3-command-effecten-taakuitvoering"><bdi class="secno">2.7.3 </bdi>Command → Effecten (Taakuitvoering)</h4>
<ul>
<li><strong>Commandprocessor</strong> ontvangt commands en bepaalt welke <em>effecten</em> ontstaan</li>
<li>Voert domeinregels uit en valideert tegen bestaande gegevens via projecties</li>
<li>Effecten beschrijven de daadwerkelijke veranderingen binnen het domein</li>
</ul>
</section><section id="effecten-projecties-presentatieopmaking"><h4 id="x2-7-4-effecten-projecties-presentatieopmaking"><bdi class="secno">2.7.4 </bdi>Effecten → Projecties (Presentatieopmaking)</h4>
<ul>
<li><strong>Effectprocessor</strong> maakt <em>projecties</em> op basis van effecten</li>
<li>Projecties bevatten alleen informatie uit het eigen domein ('data bij de bron')</li>
<li>Elke projectie is afgestemd op specifieke (groepen van)[^1] informatiebehoeften</li>
</ul>
</section><section id="register-commands-effecten-projecties"><h4 id="x2-7-5-register-commands-effecten-projecties"><bdi class="secno">2.7.5 </bdi>Register = Commands + Effecten + Projecties</h4>
<p>Het register bestaat uit:</p>
<ul>
<li><strong>Commands</strong>: De opdrachten aan het register, aangeboden met de intentie daarin een verandering
aan te brengen</li>
<li><strong>Effecten</strong>: De waarheid van het domein - wat er werkelijk is gebeurd</li>
<li><strong>Projecties</strong>: Verschillende views op deze waarheid voor verschillende gebruikers</li>
</ul>
<p><strong>Syntheses</strong>[^3] (views die meerdere domeinen combineren) vallen buiten het register en verdienen
eigen architectuur.</p>
<p>[^1]: Dit is conceptueel juist, maar zeker geen dagelijkse praktijk. In de informatiebehoeften van
    verschillende afnemers zijn vaak overeenkomstigheden te vinden, zodat groepering voor de hand.
    Richtlijnen en overwegingen gaan nog (elders) beschreven worden.</p>
<p>[^2]: <a href="https://verraes.net/2025/08/domain-and-bounded-contexts-dont-map-one-on-one/">No, Your Domains and Bounded Contexts Don’t Map 1 on
    1</a> - Mathias
    Verraes.</p>
<p>[^3]: Naar <a href="https://chronolexografie-3e7a8b.gitlab.io/">Chronolexografie</a>, een conceptueel model en
    specifieke architectuur voor het digitaal vastleggen en bijhouden van de rechtstoestand. De
    <em>projecties</em> in bovenstaand artikel zijn te relateren aan de <em>reductie</em> uit Chronolexografie.
    Met <em>synthese</em> wordt in beide artikelen geduid op analyse en <em>view</em> op meer dan alleen
    projecties en reducties uit registers. Het betreft vaak uitgebreidere verwerkingen,
    transformaties en combinatie met meerdere projecties uit verschillende registers.</p>
</section></section></section>

  <script>
    let content = "";

    const getClass = function(key) {
      if (respecConfig.content[key]!==""){return ` class="${respecConfig.content[key]}"`}
    }

    for (let contentKey in respecConfig.content) {
      content += `<section data-include-format="markdown" data-include="${contentKey}.md" ${getClass(contentKey)||""}></section>`
    }

    document.getElementById("probl").insertAdjacentHTML('afterend', content);
  </script>
  <section id="conformance"><h2 id="x3-conformiteit"><bdi class="secno">3. </bdi>Conformiteit</h2><p>Naast onderdelen die als niet normatief gemarkeerd zijn, zijn ook alle diagrammen, voorbeelden, en noten in dit document niet normatief. Verder is alles in dit document normatief.</p></section>
  <section id="tof"></section>
  <section id="index" class="appendix"><h2 id="a-index"><bdi class="secno">A. </bdi>Index</h2><section id="index-defined-here">
    <h3 id="a-1-begrippen-gedefinieerd-door-deze-specificatie"><bdi class="secno">A.1 </bdi>Begrippen gedefinieerd door deze specificatie</h3>
    <ul class="index">
    
  </ul>
  </section><section id="index-defined-elsewhere">
    <h3 id="a-2-begrippen-gedefinieerd-door-verwijzing"><bdi class="secno">A.2 </bdi>Begrippen gedefinieerd door verwijzing</h3>
    <ul class="index">
    
  </ul>
  </section></section>



<section id="references" class="appendix"><h2 id="b-referenties"><bdi class="secno">B. </bdi>Referenties</h2><section id="normatieve-referenties">
    <h3 id="b-1-normatieve-referenties"><bdi class="secno">B.1 </bdi>Normatieve referenties</h3>
    <dl class="bibliography"><dt id="bib-domain-driven-design">[domain-driven-design]</dt><dd>
      <em class="respec-offending-element">Reference not found.</em>
    </dd><dt id="bib-domain-driven-design#the-blue-book">[domain-driven-design#the-blue-book]</dt><dd>
      <em class="respec-offending-element">Reference not found.</em>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://gitdocumentatie.logius.nl/publicatie/respec/fixup.js"></script></body></html>